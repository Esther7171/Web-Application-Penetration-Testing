# Lab 2: [Exploiting NoSQL operator injection to bypass authentication](https://portswigger.net/web-security/nosql-injection/lab-nosql-injection-bypass-authentication)

![image](https://github.com/user-attachments/assets/bc791cbd-490d-47e3-abca-5469af225386)

In this lab scenario,the login functionality is backed by a MongoDB NoSQL database and is vulnerable to injection using MongoDB query operators.

Objective: Exploit the NoSQL injection vulnerability to log in as the `administrator` user.

You can also log in to your own account using the following credentials:
* Username: `wiener`
* Password: `peter`

### Accessing the Lab

![image](https://github.com/user-attachments/assets/b86ac339-4054-4ecc-a85b-e6e6df78ca35)

**Step 1:** Click on the **"My Account"** button.

![image](https://github.com/user-attachments/assets/333f4de8-3f12-4884-ab0c-9157210c4731)

**Step 2:**

* Log in using the provided credentials:
  **Username:** `wiener`
  **Password:** `peter`
* Open **Burp Suite** and make sure **Intercept** is turned **ON**.
* Submit the login form and capture the HTTP request in Burp.

![image](https://github.com/user-attachments/assets/8c5fffd5-5913-4450-a24b-9326197f77d0)

**Step 3:**
Send the captured login request to the **Repeater** tab for further inspection and testing.

![image](https://github.com/user-attachments/assets/a51547d8-a4ca-4b68-b49d-3763a45eff55)

The response shows a **302 redirect**, confirming that the `wiener` user credentials are valid. Let’s now check for potential injection points.

**Step 4:**

To test for NoSQL injection, we’ll use the `$ne` (Not Equal) operator in the login request.

Modify the `username` parameter in the request from `"wiener"` to `{"$ne":""}`. This alteration attempts to match any username that is **not equal** to an empty string, which may bypass authentication controls.

```json
  {"username":{"$ne":""},"password":"peter"}
```

![image](https://github.com/user-attachments/assets/2030b1fd-3402-4ef6-b5b5-c5f18ce7a0cd)

the application is vulnerable, this injection will allow you to bypass the login and gain access—confirming that NoSQL injection is possible.
---
Here’s an improved version of your third part, keeping it clear, professional, and easy to follow:

---

**Step 5:**

Next, we’ll use the `$regex` operator to perform a pattern-based injection on the `username` parameter.

Update the value of `username` from `{"$ne":""}` to:

```json
{"username":{"$regex":"wien.*"},"password":"peter"}
```

This payload uses a regular expression to match any username starting with "wien", such as "wiener". If the application does not properly sanitize inputs, this allows you to bypass normal authentication logic.

![image](https://github.com/user-attachments/assets/e1a8733a-db8d-493b-a444-680442155ffd)

Upon sending the request, you'll notice successful login—confirming that the NoSQL injection using the `$regex` operator is effective.

**Step 6:** Bypassing Both Username and Password Validation

Now, with the `username` parameter still set to use a regex pattern, modify the `password` parameter to use the `$ne` (not equal) operator:

```json
{"username":{"$regex":"wien.*"},"password":{"$ne":""}}
```

This tells the application to authenticate any user whose username starts with "wien" **and** whose password is **not empty**.
Sending this request may return multiple matches, indicating that multiple user records are being evaluated due to unsanitized input.

![image](https://github.com/user-attachments/assets/ff1e4ebb-876d-47d3-9110-2fa669f25fd0)


**Step 7:** Logging in as Administrator

Finally, modify the `username` parameter to target the admin user using a regex pattern, while keeping the password check broad:

```json
{"username":{"$regex":"admin.*"},"password":{"$ne":""}}
```

This payload attempts to match any username starting with "admin" and any non-empty password.

![image](https://github.com/user-attachments/assets/6c8f441e-6592-4e5e-b6ad-66713b9e1f77)

If successful, this logs you in as the **administrator**.

**Step 8:** Verifying in Browser

Right-click on the request in Burp Repeater, select **"Show in browser"**, then copy and paste the generated URL into your browser to confirm access.

![image](https://github.com/user-attachments/assets/77f4710f-ca54-4736-9c0c-fcd75f89ac1b)

✅ We’ve successfully completed the lab!
