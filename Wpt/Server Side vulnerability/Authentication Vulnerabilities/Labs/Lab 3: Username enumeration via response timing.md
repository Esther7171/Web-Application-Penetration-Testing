# Lab 3: [Username enumeration via response timing](https://portswigger.net/web-security/authentication/password-based/lab-username-enumeration-via-response-timing)

In this lab scenario, the login page has a IP-based brute-force protection.
Our Credentials are provided:`wiener`:`peter`

### Accessing the Lab.

![image](https://github.com/user-attachments/assets/3dae2bba-d824-4f9b-97f8-935a852694d8)

#### Step 1: Click on "My Account"

After clicking on "My Account," a login page will appear. Let try manually guess and let see after how many attempts we block:

![image](https://github.com/user-attachments/assets/a82a78e2-c02e-4c70-843a-035e1e0d04f3)

Its block my Ip after 3 or 4 attempts

![image](https://github.com/user-attachments/assets/db874294-f97b-4666-8f2f-74132e6e6cdd)

The Question is should i wait for timer reset Na ! , Instead of waiting and To Get More Log-in Attempts We need to use Headers
`X-FORWARDED-FOR` Header 
What X-Forwarded-for header do, basically it tells the webserver the request of clint came for which particular Ip.
X-Forwarded-For header allows Us to spoof Our IP address and bypass the IP-based brute-force protection.
Let send and capture request to bserve this

#### Step 2: Capture the Request in Burp Suite

1. Open Burp Suite and turn **Intercept On**.
2. Attempt to log in with the credentials entered in the previous step.

![image](https://github.com/user-attachments/assets/adf47e33-5efb-4ae9-891f-14e47fc2207b)

### Step 3: Observation
1. Send this request to repeater to observe the IP block system
2. click on `Action` and select `Send to Repeater`.

![image](https://github.com/user-attachments/assets/40441db7-c729-44bc-b501-db660d660e2f)

![image](https://github.com/user-attachments/assets/ff024f61-55b2-427a-af41-70e71d3c8c35)

3. Send the request to check the response

![image](https://github.com/user-attachments/assets/3842926a-12a6-4433-962f-1f69929ce19c)

4. Write now with valid credential im not blocked let change password and send the request to get blocked again
5. after 2 fail attempt my Ip got blocked

![image](https://github.com/user-attachments/assets/bc3d9ce6-db64-4384-935b-3188a23f9682)

6. Now to bypass this authentication function modify the request by adding Header.
```
X-Forwarded-For: 10.10.1.1
```

![image](https://github.com/user-attachments/assets/c1f51116-dd2e-4f74-a796-8271cf92252b)

7. After adding the header the timer got reset,moving on next step

8. But wait there Is another fault that called response time

9. see this time my user is `valid` and password is `incorrect`

![image](https://github.com/user-attachments/assets/3bc36239-628d-4ec5-bc19-6c5dc7da053d)

10. See the response time

![image](https://github.com/user-attachments/assets/afaa8560-3d2a-4fcd-bee6-2431d9be0c7f)

11. Let enter valid password

![image](https://github.com/user-attachments/assets/650510d8-1cef-42c8-abb4-4b6eedb0ddb0)

12. See change in response time

![image](https://github.com/user-attachments/assets/352c55cf-deba-44e5-acf4-836b503d59d3)

13. Let try chnage both user and password

![image](https://github.com/user-attachments/assets/0bc3441e-0d8c-48d1-9d4b-38a33b050fbb)

14. See the time got decrease

![image](https://github.com/user-attachments/assets/7aba0df4-f540-4c73-a055-2388d8abbd87)

15. If we use a basic logic:
  * In 1st attempt valid `username` invalid `password` = 243 millis
  * both user&pass `valid` = 209 millis
  * both user&pass `invalid` = 163 millis

16. So as we can see WE have a response delay let increase the password length

![image](https://github.com/user-attachments/assets/9e5ff5b5-57ef-46df-9547-b02a8aafec76)

17. As i replace the password with random long string the dealy is too much 

![image](https://github.com/user-attachments/assets/05fb356b-d4d3-4a59-b4ce-b5415f16d009)

#### Step 4: Configuring the Intruder Attack
1. Send the request to Intruder
2. In the **Intruder** tab, select the username `admin` and click `Add §` to mark it as an attack position.
3. In request add the header like this:

> Note: dont repeat the used ip we tested in repeater or it will be blocked again and the whole bruteforce will be fail

```
X-Forwarded-For: 1
```

![image](https://github.com/user-attachments/assets/78660b6f-dba9-4fa4-803a-bbf20c6ccf88)

Change the attack type to pich fork

![image](https://github.com/user-attachments/assets/c7b8510a-7e08-44fb-bce5-3e68f11f1c74)

Now mark `§1§` as payload postion and mark `username` as well pich fork allow u to brute force u at location with 2 differnt wordlist just like custer bomb

![image](https://github.com/user-attachments/assets/4a2b916a-b379-49de-b56f-54c77205191c)

as we knwo if the username is valid and password string is long we can saw the dealy in response let add random sting in password.

![image](https://github.com/user-attachments/assets/61ce40ae-ad88-4404-bcdf-20477804595f)

Navigate to the **Payloads** tab, and select Number list

![image](https://github.com/user-attachments/assets/d8439833-9ee9-4c0d-9bd1-1a4eab7c21e4)

In the Payloads side panel, select position 1 from the Payload position drop-down list. Select the Numbers payload type. Enter the range 1 - 101 and set the step to 1. Set the max fraction digits to 0. This will be used to spoof your IP.
![image](https://github.com/user-attachments/assets/2385eb16-4886-42c7-9f5a-6e0141f69fd3)

After that add worldist of 2nd postion of username 

![image](https://github.com/user-attachments/assets/39aa14c9-332d-40be-b418-3ed8b653b2d1)

copy the [Username List](https://github.com/Esther7171/Web-Application-Penetration-Testing/blob/main/Wpt/Server%20Side%20vulnerability/Authentication%20Vulnerabilities/Labs/Lab-credentials/Username-List.md), and paste it into the payload settings column by clicking on `Paste`.

![image](https://github.com/user-attachments/assets/68eda6f8-aa44-4515-97d6-3d8f1fd34409)

Start Attack

After finishing attack click on 3 dot show in image

![image](https://github.com/user-attachments/assets/c3d126e0-978c-402b-87ea-e1192bccafdf)

Enable this 2 options

![image](https://github.com/user-attachments/assets/0bc4cfde-e7af-419a-863c-7702b3859087)

we got a vast delay in this response

![image](https://github.com/user-attachments/assets/f8a9be40-c78a-4864-8ebc-808b0ef39e2c)

so we found the user `an`
Now let find the password
Send this request to intruder

The first this we need to do is to change header number like this so it will reset again
```
X-Forwarded-For: 10.1.1.1
```
Select the attack type to pich fork again and make postion like this:

![image](https://github.com/user-attachments/assets/4280d690-c1bc-4315-b81f-e8dedb55c44b)

Now do same 1st  In the Payloads side panel, select position 1 from the Payload position drop-down list. Select the Numbers payload type. Enter the range 1 - 101 and set the step to 1. Set the max fraction digits to 0. This will be used to spoof your IP.

![image](https://github.com/user-attachments/assets/6c750980-a7f6-4b3a-97e0-4fc022826373)

Change to payload set to 2nd and Paste the [Password List](https://github.com/Esther7171/Web-Application-Penetration-Testing/blob/main/Wpt/Server%20Side%20vulnerability/Authentication%20Vulnerabilities/Labs/Lab-credentials/Password-List.md).

![image](https://github.com/user-attachments/assets/46a30c88-fc4f-4727-b8b6-00266015885c)

Start The attack

![image](https://github.com/user-attachments/assets/45a6a1a1-8911-467b-b292-a0ac64b23a96)

WE got the password I made change in original request anb let forward this:

![image](https://github.com/user-attachments/assets/b3ff8265-961d-4a44-b020-8b997da1a926)

Foward all 

![image](https://github.com/user-attachments/assets/66f98f72-10fe-4ac3-8a8f-4c68ad44900f)

✅ We’ve successfully completed the lab!

-----
# Lab 3: [Username Enumeration via Response Timing](https://portswigger.net/web-security/authentication/password-based/lab-username-enumeration-via-response-timing)

In this lab scenario, the login page uses IP-based brute-force protection. We are provided with credentials: `wiener:peter`.

---

## Step 1: Access the Lab

Navigate to the lab and click on **"My Account"** to access the login page.

![Login Page](https://github.com/user-attachments/assets/a82a78e2-c02e-4c70-843a-035e1e0d04f3)

### Observation:
After 3-4 failed login attempts, the application blocks your IP.

![Blocked IP](https://github.com/user-attachments/assets/db874294-f97b-4666-8f2f-74132e6e6cdd)

---

## Step 2: Bypass Rate Limiting with `X-Forwarded-For`

The `X-Forwarded-For` header helps spoof the client IP and bypass the IP-based block.

### Steps:
1. Open Burp Suite and turn **Intercept On**.
2. Attempt a login.

![Capture Login](https://github.com/user-attachments/assets/adf47e33-5efb-4ae9-891f-14e47fc2207b)

3. Send request to **Repeater**.

![Send to Repeater](https://github.com/user-attachments/assets/40441db7-c729-44bc-b501-db660d660e2f)

4. Modify the request to add:
```
X-Forwarded-For: 10.10.1.1
```

![Modified Header](https://github.com/user-attachments/assets/c1f51116-dd2e-4f74-a796-8271cf92252b)

This bypasses the block by resetting the IP-based counter.

---

## Step 3: Response Timing Analysis

1. Use valid username (`wiener`) with wrong password:

![Valid Username](https://github.com/user-attachments/assets/3bc36239-628d-4ec5-bc19-6c5dc7da053d)
![Response Time](https://github.com/user-attachments/assets/afaa8560-3d2a-4fcd-bee6-2431d9be0c7f)

2. Use both valid username and password:

![Valid Credentials](https://github.com/user-attachments/assets/650510d8-1cef-42c8-abb4-4b6eedb0ddb0)
![Lower Response Time](https://github.com/user-attachments/assets/352c55cf-deba-44e5-acf4-836b503d59d3)

3. Use invalid credentials:

![Invalid Credentials](https://github.com/user-attachments/assets/0bc3441e-0d8c-48d1-9d4b-38a33b050fbb)
![Fast Response](https://github.com/user-attachments/assets/7aba0df4-f540-4c73-a055-2388d8abbd87)

4. Try a long password string:

![Long Password](https://github.com/user-attachments/assets/9e5ff5b5-57ef-46df-9547-b02a8aafec76)
![Significant Delay](https://github.com/user-attachments/assets/05fb356b-d4d3-4a59-b4ce-b5415f16d009)

---

## Step 4: Intruder Configuration for Username Enumeration

1. Send request to **Intruder**.
2. Select the username and `X-Forwarded-For` value as payload positions.

![Intruder Setup](https://github.com/user-attachments/assets/78660b6f-dba9-4fa4-803a-bbf20c6ccf88)

3. Set attack type to **Pitchfork**.

![Attack Type](https://github.com/user-attachments/assets/c7b8510a-7e08-44fb-bce5-3e68f11f1c74)

4. Configure payloads:
    - **Position 1 (IP spoof)**: Numbers 1-101 (step: 1)
    - **Position 2 (Usernames)**: Paste [Username List](https://github.com/Esther7171/Web-Application-Penetration-Testing/blob/main/Wpt/Server%20Side%20vulnerability/Authentication%20Vulnerabilities/Labs/Lab-credentials/Username-List.md)

![Payload Settings](https://github.com/user-attachments/assets/d8439833-9ee9-4c0d-9bd1-1a4eab7c21e4)

![Username Wordlist](https://github.com/user-attachments/assets/68eda6f8-aa44-4515-97d6-3d8f1fd34409)

5. Start the attack and filter by response time.

![Analyze Results](https://github.com/user-attachments/assets/f8a9be40-c78a-4864-8ebc-808b0ef39e2c)

You will find that `an` is the valid username.

---

## Step 5: Password Brute-force with Valid Username

1. Send new request to Intruder.
2. Update `X-Forwarded-For` to avoid blocking:
```
X-Forwarded-For: 10.1.1.1
```

3. Select attack type: **Pitchfork**
4. Configure positions:

![Password Intruder Setup](https://github.com/user-attachments/assets/4280d690-c1bc-4315-b81f-e8dedb55c44b)

5. Payloads:
    - **Position 1 (IP spoof)**: Numbers 1-101
    - **Position 2 (Passwords)**: Paste [Password List](https://github.com/Esther7171/Web-Application-Penetration-Testing/blob/main/Wpt/Server%20Side%20vulnerability/Authentication%20Vulnerabilities/Labs/Lab-credentials/Password-List.md)

![Password Payloads](https://github.com/user-attachments/assets/46a30c88-fc4f-4727-b8b6-00266015885c)

6. Start the attack and identify the valid credentials.

![Found Credentials](https://github.com/user-attachments/assets/45a6a1a1-8911-467b-b292-a0ac64b23a96)

7. Update and forward final successful login request.

![Login Request](https://github.com/user-attachments/assets/b3ff8265-961d-4a44-b020-8b997da1a926)

![Forward All](https://github.com/user-attachments/assets/66f98f72-10fe-4ac3-8a8f-4c68ad44900f)

---

## ✅ Lab Completed Successfully!
